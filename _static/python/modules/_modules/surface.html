<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>surface &mdash; Langmuir Python 2.0 documentation</title>
    
    <link rel="stylesheet" href="../static/default.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="Langmuir Python 2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for surface</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. note::</span>
<span class="sd">    Functions for calculating surfaces and analyzing them.</span>

<span class="sd">.. moduleauthor:: Adam Gagorik &lt;adam.gagorik@gmail.com&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">langmuir</span> <span class="kn">as</span> <span class="nn">lm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">scipy.special</span> <span class="kn">as</span> <span class="nn">special</span>
    <span class="kn">import</span> <span class="nn">scipy.fftpack</span> <span class="kn">as</span> <span class="nn">fftpack</span>
    <span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="kn">as</span> <span class="nn">ndimage</span>
    <span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">signal</span>
    <span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>
    <span class="kn">import</span> <span class="nn">scipy.misc</span> <span class="kn">as</span> <span class="nn">misc</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">special</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">fftpack</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">ndimage</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">misc</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="make_3D"><a class="viewcode-back" href="../modules/surface.html#surface.make_3D">[docs]</a><span class="k">def</span> <span class="nf">make_3D</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Force the numpy array passed to be 3D via :py:func:`np.expand_dims`.</span>

<span class="sd">    :param array: numpy array</span>
<span class="sd">    :type array: :py:class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ndims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ndims</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">array</span>

    <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s">&#39;can not expand dimensions&#39;</span>
</div>
<div class="viewcode-block" id="load_ascii"><a class="viewcode-back" href="../modules/surface.html#surface.load_ascii">[docs]</a><span class="k">def</span> <span class="nf">load_ascii</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cube</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around np.loadtxt.  Forces data to be at least 3 dimensions.</span>

<span class="sd">    :param square: reshape as if data is NxN</span>
<span class="sd">    :param cube: reshape as if data is NxNxN</span>
<span class="sd">    :parm shape: reshape data</span>

<span class="sd">    :param square: bool</span>
<span class="sd">    :param cube: bool</span>
<span class="sd">    :param shape: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># load the data</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">square</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s">&#39;can not reshape data&#39;</span>

    <span class="k">if</span> <span class="n">cube</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s">&#39;can not reshape data&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>

    <span class="c"># force data to be 3D</span>
    <span class="k">return</span> <span class="n">make_3D</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="load_chk"><a class="viewcode-back" href="../modules/surface.html#surface.load_chk">[docs]</a><span class="k">def</span> <span class="nf">load_chk</span><span class="p">(</span><span class="n">handle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load checkpoint file and convert traps into a surface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chk</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">checkpoint</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
    <span class="n">chk</span><span class="o">.</span><span class="n">fix_traps</span><span class="p">()</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_checkpoint</span><span class="p">(</span><span class="n">chk</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">chk</span><span class="o">.</span><span class="n">potentials</span><span class="p">:</span>
        <span class="n">xyzv</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">XYZV</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">chk</span><span class="o">.</span><span class="n">traps</span><span class="p">,</span> <span class="n">chk</span><span class="o">.</span><span class="n">potentials</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;trap.potential&#39;</span> <span class="ow">in</span> <span class="n">chk</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">xyzv</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">XYZV</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">chk</span><span class="o">.</span><span class="n">traps</span><span class="p">,</span> <span class="n">chk</span><span class="p">[</span><span class="s">&#39;trap.potential&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyzv</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">XYZV</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">chk</span><span class="o">.</span><span class="n">traps</span><span class="p">,</span> <span class="n">chk</span><span class="p">[</span><span class="s">&#39;trap.potential&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">make_3D</span><span class="p">(</span><span class="n">xyzv</span><span class="o">.</span><span class="n">mv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="load"><a class="viewcode-back" href="../modules/surface.html#surface.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">rot90</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load surface from file.  Takes into account the file extension.</span>

<span class="sd">    ===== ===============================</span>
<span class="sd">    *ext* *func*</span>
<span class="sd">    ===== ===============================</span>
<span class="sd">    pkl   :py:meth:`common.load_pkl`</span>
<span class="sd">    npy   :py:func:`numpy.load`</span>
<span class="sd">    chk   :py:meth:`surface.load_chk`</span>
<span class="sd">    inp   :py:meth:`surface.load_chk`</span>
<span class="sd">    csv   :py:meth:`surface.load_ascii`</span>
<span class="sd">    txt   :py:meth:`surface.load_ascii`</span>
<span class="sd">    dat   :py:meth:`surface.load_ascii`</span>
<span class="sd">    png   :py:meth:`scipy.ndimage.imread`</span>
<span class="sd">    jpg   :py:meth:`scipy.ndimage.imread`</span>
<span class="sd">    jpeg  :py:meth:`scipy.ndimage.imread`</span>
<span class="sd">    ===== ===============================</span>

<span class="sd">    :param handle: filename</span>
<span class="sd">    :param rot90: number of times to rotate image by 90 degrees</span>

<span class="sd">    :type handle: str</span>
<span class="sd">    :type rot90: int</span>

<span class="sd">    :return: image</span>
<span class="sd">    :rtype: :py:class:`numpy.ndarray`</span>

<span class="sd">    .. warning::</span>
<span class="sd">        image file (png, jpg, etc) data is forced into range [0,255].</span>

<span class="sd">    .. warning::</span>
<span class="sd">        data is always made 3D via :py:func:`numpy.expand_dims`</span>

<span class="sd">    .. warning::</span>
<span class="sd">        image data is rotated by -90 degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">handle</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.gz&#39;</span><span class="p">):</span>
        <span class="n">stub</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;.gz&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stub</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.pkl&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_3D</span><span class="p">(</span><span class="n">lm</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">load_pkl</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.npy&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;.chk&#39;</span><span class="p">,</span> <span class="s">&#39;.inp&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">load_chk</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;.csv&#39;</span><span class="p">,</span> <span class="s">&#39;.txt&#39;</span><span class="p">,</span> <span class="s">&#39;.dat&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">load_ascii</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;.png&#39;</span><span class="p">,</span> <span class="s">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;.jpeg&#39;</span><span class="p">]:</span>
        <span class="n">_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">flatten</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rot90</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">make_3D</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s">&#39;ext=</span><span class="si">%s</span><span class="s"> not supported&#39;</span> <span class="o">%</span> <span class="n">ext</span>
</div>
<div class="viewcode-block" id="save_vti"><a class="viewcode-back" href="../modules/surface.html#surface.save_vti">[docs]</a><span class="k">def</span> <span class="nf">save_vti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save numpy array to vtkImageData XML file.  You can open it in paraview.</span>

<span class="sd">    :param handle: filename</span>
<span class="sd">    :param array: data</span>

<span class="sd">    :type handle: str</span>
<span class="sd">    :type array: :py:class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vtkImageData</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">vtkutils</span><span class="o">.</span><span class="n">create_image_data_from_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">lm</span><span class="o">.</span><span class="n">vtkutils</span><span class="o">.</span><span class="n">save_image_data</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">vtkImageData</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="save_chk"><a class="viewcode-back" href="../modules/surface.html#surface.save_chk">[docs]</a><span class="k">def</span> <span class="nf">save_chk</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save numpy array to Langmuir checkpoint file.</span>

<span class="sd">    :param handle: filename</span>
<span class="sd">    :param array: data</span>

<span class="sd">    :type handle: str</span>
<span class="sd">    :type array: :py:class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">chk</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">checkpoint</span><span class="o">.</span><span class="n">CheckPoint</span><span class="o">.</span><span class="n">from_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">traps</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">IndexMapper</span><span class="o">.</span><span class="n">map_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
    <span class="n">chk</span><span class="o">.</span><span class="n">traps</span> <span class="o">=</span> <span class="n">traps</span>
    <span class="n">chk</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="save"><a class="viewcode-back" href="../modules/surface.html#surface.save">[docs]</a><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">zlevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save object to a file.  Takes into account the file extension.</span>

<span class="sd">    ===== ===================================</span>
<span class="sd">    *ext* *func*</span>
<span class="sd">    ===== ===================================</span>
<span class="sd">    pkl   :py:meth:`common.load_pkl`</span>
<span class="sd">    npy   :py:func:`numpy.load`</span>
<span class="sd">    vti   :py:meth:`surface.save_cti`</span>
<span class="sd">    csv   :py:meth:`np.savetxt`</span>
<span class="sd">    txt   :py:meth:`np.savetxt`</span>
<span class="sd">    dat   :py:meth:`np.savetxt`</span>
<span class="sd">    png   :py:meth:`scipy.misc.imsave`</span>
<span class="sd">    jpg   :py:meth:`scipy.misc.imsave`</span>
<span class="sd">    jpeg  :py:meth:`scipy.misc.imsave`</span>
<span class="sd">    ===== ===================================</span>

<span class="sd">    :param handle: filename</span>
<span class="sd">    :param obj: object to save</span>
<span class="sd">    :param zlevel: slice z-index</span>

<span class="sd">    :type handle: str</span>
<span class="sd">    :type array: :py:class:`numpy.ndarray`</span>
<span class="sd">    :type zlevel: int</span>

<span class="sd">    .. warning::</span>
<span class="sd">        image file (png, jpg, etc) data is forced into range [0,255].</span>

<span class="sd">    .. warning::</span>
<span class="sd">        if ndims is 3 and an image file is being saved, only a slice is saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stub</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.pkl&#39;</span><span class="p">:</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">save_pkl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.npy&#39;</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.vti&#39;</span><span class="p">:</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">save_vti</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;.chk&#39;</span><span class="p">,</span> <span class="s">&#39;.inp&#39;</span><span class="p">]:</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">save_chk</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;.csv&#39;</span><span class="p">,</span> <span class="s">&#39;.txt&#39;</span><span class="p">,</span> <span class="s">&#39;.dat&#39;</span><span class="p">]:</span>
        <span class="n">_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%+.18e</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">zhandle</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">handle</span><span class="p">,</span> <span class="s">&#39;# &#39;</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle</span>

    <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;.png&#39;</span><span class="p">,</span> <span class="s">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;.jpeg&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[:,:,</span><span class="n">zlevel</span><span class="p">]</span>
        <span class="n">misc</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">handle</span>

    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s">&#39;ext=</span><span class="si">%s</span><span class="s"> not supported&#39;</span> <span class="o">%</span> <span class="n">ext</span>
</div>
<div class="viewcode-block" id="threshold"><a class="viewcode-back" href="../modules/surface.html#surface.threshold">[docs]</a><span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set values in array above {v} to {v1}, and below {v} to {v0}.</span>

<span class="sd">    :param v: threshold value</span>
<span class="sd">    :param v0: lower value</span>
<span class="sd">    :param v1: upper value</span>
<span class="sd">    :param copy: copy array</span>

<span class="sd">    :type v: float</span>
<span class="sd">    :type v0: float</span>
<span class="sd">    :type v1: float</span>
<span class="sd">    :type copy: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">t</span><span class="p">[</span><span class="n">t</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">t</span><span class="p">[</span><span class="n">t</span> <span class="o">&gt;</span>  <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v0</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>
    <span class="k">return</span> <span class="n">t</span>
</div>
<div class="viewcode-block" id="linear_mapping"><a class="viewcode-back" href="../modules/surface.html#surface.linear_mapping">[docs]</a><span class="k">def</span> <span class="nf">linear_mapping</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map values in array to fall in the range [n,m].</span>

<span class="sd">    :param array: array like object</span>
<span class="sd">    :param n: lower bound</span>
<span class="sd">    :param m: upper bound</span>

<span class="sd">    :type n: float</span>
<span class="sd">    :type m: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span>
</div>
<div class="viewcode-block" id="rfunc"><a class="viewcode-back" href="../modules/surface.html#surface.rfunc">[docs]</a><span class="k">def</span> <span class="nf">rfunc</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces numbers in the range [-0.5, 0.5].</span>

<span class="sd">    :param size: shape of output</span>
<span class="sd">    :type: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
</div>
<div class="viewcode-block" id="WaveDimensions"><a class="viewcode-back" href="../modules/surface.html#surface.WaveDimensions">[docs]</a><span class="k">class</span> <span class="nc">WaveDimensions</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Compute wavelength, wavenumber, etc from an interval length (L)</span>
<span class="sd">    and number of waves (n).</span>

<span class="sd">    :param L: interval length</span>
<span class="sd">    :param n: number of waves in interval</span>

<span class="sd">    :type L: float</span>
<span class="sd">    :type n: int</span>

<span class="sd">    &gt;&gt;&gt; wx = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; print wx</span>
<span class="sd">    [Wave Dimensions]</span>
<span class="sd">        L      = 10</span>
<span class="sd">        n      = 2</span>
<span class="sd">        lambda = 5.00000e+00</span>
<span class="sd">        nubar  = 2.00000e-01</span>
<span class="sd">        k      = 1.25664e+00</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nubar</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc</span><span class="p">()</span>

<div class="viewcode-block" id="WaveDimensions.calc"><a class="viewcode-back" href="../modules/surface.html#surface.WaveDimensions.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform calculations to compute wavelength, wavenumber, etc.</span>
<span class="sd">        Called automatically in constructor.</span>

<span class="sd">        :param L: interval length</span>
<span class="sd">        :param n: number of waves in interval</span>

<span class="sd">        :type L: float</span>
<span class="sd">        :type n: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nubar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="s">&#39;[Wave Dimensions]</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    L      = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    n      = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    lambda = </span><span class="si">%.5e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    nubar  = </span><span class="si">%.5e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nubar</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;    k      = </span><span class="si">%.5e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<span class="n">f_sin_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">f_sin_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
<span class="n">f_sin_z</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
<span class="n">f_cos_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">f_cos_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
<span class="n">f_cos_z</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>

<span class="n">sin_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">sin_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wy</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
<span class="n">sin_z</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wz</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
<span class="n">cos_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">cos_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wy</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
<span class="n">cos_z</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wz</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>

<div class="viewcode-block" id="f_gyroid"><a class="viewcode-back" href="../modules/surface.html#surface.f_gyroid">[docs]</a><span class="k">def</span> <span class="nf">f_gyroid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for gyroid.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; gyroid(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="gyroid"><a class="viewcode-back" href="../modules/surface.html#surface.gyroid">[docs]</a><span class="k">def</span> <span class="nf">gyroid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_gyroid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="f_scherk_first_surface"><a class="viewcode-back" href="../modules/surface.html#surface.f_scherk_first_surface">[docs]</a><span class="k">def</span> <span class="nf">f_scherk_first_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for scherk.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; scherk_first_surface(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kx</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="scherk_first_surface"><a class="viewcode-back" href="../modules/surface.html#surface.scherk_first_surface">[docs]</a><span class="k">def</span> <span class="nf">scherk_first_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_scherk_first_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="f_schwarz_p_surface"><a class="viewcode-back" href="../modules/surface.html#surface.f_schwarz_p_surface">[docs]</a><span class="k">def</span> <span class="nf">f_schwarz_p_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for psurface.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; schwarz_p_surface(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="schwarz_p_surface"><a class="viewcode-back" href="../modules/surface.html#surface.schwarz_p_surface">[docs]</a><span class="k">def</span> <span class="nf">schwarz_p_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_schwarz_p_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="f_schwarz_d_surface"><a class="viewcode-back" href="../modules/surface.html#surface.f_schwarz_d_surface">[docs]</a><span class="k">def</span> <span class="nf">f_schwarz_d_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for dsurface.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; schwarz_d_surface(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="schwarz_d_surface"><a class="viewcode-back" href="../modules/surface.html#surface.schwarz_d_surface">[docs]</a><span class="k">def</span> <span class="nf">schwarz_d_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_schwarz_d_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="f_bandXY"><a class="viewcode-back" href="../modules/surface.html#surface.f_bandXY">[docs]</a><span class="k">def</span> <span class="nf">f_bandXY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for bands that run along z-direction.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; bandXY(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bandXY"><a class="viewcode-back" href="../modules/surface.html#surface.bandXY">[docs]</a><span class="k">def</span> <span class="nf">bandXY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_bandXY</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="f_bandXZ"><a class="viewcode-back" href="../modules/surface.html#surface.f_bandXZ">[docs]</a><span class="k">def</span> <span class="nf">f_bandXZ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for bands that run along y-direction.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; bandXZ(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bandXZ"><a class="viewcode-back" href="../modules/surface.html#surface.bandXZ">[docs]</a><span class="k">def</span> <span class="nf">bandXZ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_bandXZ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="f_bandYZ"><a class="viewcode-back" href="../modules/surface.html#surface.f_bandYZ">[docs]</a><span class="k">def</span> <span class="nf">f_bandYZ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for bands that run along x-direction.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param kx: 2 pi nx / Lx</span>
<span class="sd">    :param ky: 2 pi ny / Ly</span>
<span class="sd">    :param kz: 2 pi nz / Lz</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type kx: float</span>
<span class="sd">    :type ky: float</span>
<span class="sd">    :type kz: float</span>

<span class="sd">    &gt;&gt;&gt; w = WaveDimensions(10, 2)</span>
<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; bandYZ(x, y, z, w.k, w.k, w.k)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ky</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kz</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="bandYZ"><a class="viewcode-back" href="../modules/surface.html#surface.bandYZ">[docs]</a><span class="k">def</span> <span class="nf">bandYZ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper around f_* that uses WaveDimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f_bandYZ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wy</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">wz</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Kernel"><a class="viewcode-back" href="../modules/surface.html#surface.Kernel">[docs]</a><span class="k">class</span> <span class="nc">Kernel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An x, y, z, v mgrid.</span>

<span class="sd">    :param xmin: lower x</span>
<span class="sd">    :param xmax: upper x</span>
<span class="sd">    :param ymin: lower y</span>
<span class="sd">    :param ymax: upper y</span>
<span class="sd">    :param zmin: lower z</span>
<span class="sd">    :param zmax: upper z</span>
<span class="sd">    :param spacing: grid spacing</span>

<span class="sd">    :type xmin: float</span>
<span class="sd">    :type xmax: float</span>
<span class="sd">    :type ymin: float</span>
<span class="sd">    :type ymax: float</span>
<span class="sd">    :type zmin: float</span>
<span class="sd">    :type zmax: float</span>
<span class="sd">    :type spacing: float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">:</span><span class="n">spacing</span><span class="p">,</span>
                                          <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">:</span><span class="n">spacing</span><span class="p">,</span>
                                          <span class="n">zmin</span><span class="p">:</span><span class="n">zmax</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">:</span><span class="n">spacing</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">spacing</span>
</div>
<div class="viewcode-block" id="FuncKernel"><a class="viewcode-back" href="../modules/surface.html#surface.FuncKernel">[docs]</a><span class="k">class</span> <span class="nc">FuncKernel</span><span class="p">(</span><span class="n">Kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An x, y, z, v mgrid.  Computes v using the function = f(x, y, z) passed.</span>
<span class="sd">    See Kernel for more parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Kernel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimpleKernel"><a class="viewcode-back" href="../modules/surface.html#surface.SimpleKernel">[docs]</a><span class="k">class</span> <span class="nc">SimpleKernel</span><span class="p">(</span><span class="n">FuncKernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An x, y, z, v mgrid.  Computes v using the function = f(x, y, z) passed.</span>
<span class="sd">    Creates x, y, z domain using spacing and number of points.</span>

<span class="sd">    :param func: function of x, y, z</span>
<span class="sd">    :param nx: x-direction has 2*nx + 1 points</span>
<span class="sd">    :param ny: y-direction has 2*ny + 1 points</span>
<span class="sd">    :param nz: z-direction has 2*nz + 1 points</span>
<span class="sd">    :param spacing: grid spacing</span>

<span class="sd">    :type func: func</span>
<span class="sd">    :type nx: int</span>
<span class="sd">    :type ny: int</span>
<span class="sd">    :type nz: int</span>
<span class="sd">    :type spacing: double</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">spacing</span> <span class="o">*</span> <span class="n">nx</span><span class="p">,</span> <span class="n">spacing</span> <span class="o">*</span> <span class="n">nx</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="n">spacing</span> <span class="o">*</span> <span class="n">ny</span><span class="p">,</span> <span class="n">spacing</span> <span class="o">*</span> <span class="n">ny</span>
        <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">spacing</span> <span class="o">*</span> <span class="n">nz</span><span class="p">,</span> <span class="n">spacing</span> <span class="o">*</span> <span class="n">nz</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">spacing</span><span class="p">]</span>
        <span class="n">FuncKernel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RandomKernel"><a class="viewcode-back" href="../modules/surface.html#surface.RandomKernel">[docs]</a><span class="k">class</span> <span class="nc">RandomKernel</span><span class="p">(</span><span class="n">SimpleKernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An x, y, z, v mgrid.  Computes v using random noise. Creates x, y, z domain</span>
<span class="sd">    using spacing and number of points.  See SimpleKernel for more parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">SimpleKernel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GaussianKernel"><a class="viewcode-back" href="../modules/surface.html#surface.GaussianKernel">[docs]</a><span class="k">class</span> <span class="nc">GaussianKernel</span><span class="p">(</span><span class="n">Kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An x, y, z, v mgrid.  The size of the grid is determined using the stdev</span>
<span class="sd">    of the Gaussian PDF.</span>

<span class="sd">    :param sx: sigma x</span>
<span class="sd">    :param sy: sigma y</span>
<span class="sd">    :param sz: sigma z</span>
<span class="sd">    :param mx: mean x</span>
<span class="sd">    :param my: mean y</span>
<span class="sd">    :param mz: mean z</span>
<span class="sd">    :param spacing: grid spacing</span>

<span class="sd">    :type sx: float</span>
<span class="sd">    :type sy: float</span>
<span class="sd">    :type sz: float</span>
<span class="sd">    :type mx: float</span>
<span class="sd">    :type my: float</span>
<span class="sd">    :type mz: float</span>
<span class="sd">    :type spacing: float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">mx</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">my</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">mz</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sz</span> <span class="o">=</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sx</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sx</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
        <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sz</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sz</span>
        <span class="n">Kernel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span>
        <span class="n">dst_x</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">sx</span><span class="p">)</span>
        <span class="n">dst_y</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">my</span><span class="p">,</span> <span class="n">sy</span><span class="p">)</span>
        <span class="n">dst_z</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">sz</span><span class="p">)</span>
        <span class="n">pdf_x</span>  <span class="o">=</span> <span class="n">dst_x</span><span class="o">.</span><span class="n">pdf</span>
        <span class="n">pdf_y</span>  <span class="o">=</span> <span class="n">dst_y</span><span class="o">.</span><span class="n">pdf</span>
        <span class="n">pdf_z</span>  <span class="o">=</span> <span class="n">dst_z</span><span class="o">.</span><span class="n">pdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">pdf_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">pdf_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">pdf_z</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[Kernel]</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-7s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;shape&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-7s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;spacing&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="Isotropic"><a class="viewcode-back" href="../modules/surface.html#surface.Isotropic">[docs]</a><span class="k">class</span> <span class="nc">Isotropic</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs convolution of random noise with a kernel to make morphology.</span>

<span class="sd">    :param grid: grid</span>
<span class="sd">    :param kernel: Kernel instance</span>
<span class="sd">    :param rfunc: function that produces random numbers in range [-0.5,0.5]</span>

<span class="sd">    :type grid: :py:class:`surface.Grid`</span>
<span class="sd">    :type kernel: Kernel</span>
<span class="sd">    :type rfunc: func</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">rfunc</span><span class="o">=</span><span class="n">rfunc</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;same&#39;</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: be patient, convolution is slow&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>   <span class="o">=</span> <span class="n">grid</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: creating noise&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span>  <span class="o">=</span> <span class="n">rfunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c">#kernel and grid must have the same spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">spacing</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: factor = </span><span class="si">%.3e</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="c"># calculate on grid with same spacing as kernel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">lx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ly</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">lz</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>

            <span class="c"># zoom in random noise</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: interpolating noise&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_noise</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>

            <span class="c"># convolve kernel and noise</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: convoluting&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_noise</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

            <span class="c"># zoom out on image</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: interpolating image&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_image</span> <span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># no zooming needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;isotropic: convoluting&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_noise</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;&#39;</span>
        <span class="c">#print &#39;grid   == z_grid  &#39;, self.grid is self.z_grid</span>
        <span class="c">#print &#39;noise  == z_noise &#39;, self.noise is self.z_noise</span>
        <span class="c">#print &#39;image  == z_image &#39;, self.image is self.z_image</span>
        <span class="c">#print &#39;thresh == z_thresh&#39;, self.thresh is self.z_thresh</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;[Isotropic]</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-6s</span><span class="s"> = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;grid&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="o">.</span><span class="n">shape</span>  <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-6s</span><span class="s"> = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;noise&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">z_noise</span><span class="o">.</span><span class="n">shape</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-6s</span><span class="s"> = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">z_image</span><span class="o">.</span><span class="n">shape</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="f_isotropic"><a class="viewcode-back" href="../modules/surface.html#surface.f_isotropic">[docs]</a><span class="k">def</span> <span class="nf">f_isotropic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface function f(x,y,z) for isotropic morphology according to Jake.</span>

<span class="sd">    :param x: x-value(s)</span>
<span class="sd">    :param y: y-value(s)</span>
<span class="sd">    :param z: z-value(s)</span>
<span class="sd">    :param sx: sigma x</span>
<span class="sd">    :param sy: sigma y</span>
<span class="sd">    :param sz: sigma z</span>

<span class="sd">    :type x: float</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :type z: float</span>
<span class="sd">    :type sx: float</span>
<span class="sd">    :type sy: float</span>
<span class="sd">    :type sz: float</span>

<span class="sd">    &gt;&gt;&gt; x, y, z = np.mgrid[0:10:100j,0:10:100j,0:10:100j]</span>
<span class="sd">    &gt;&gt;&gt; isotropic(x, y, z, 1, 1, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ysize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">zsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">GaussianKernel</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">zsize</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">Isotropic</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">image</span>
</div>
<span class="k">def</span> <span class="nf">isotropic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">,</span> <span class="n">wz</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_isotropic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
                       <span class="n">full</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FFT</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_delta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">s0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">delta</span>

<span class="k">class</span> <span class="nc">FFT1D</span><span class="p">(</span><span class="n">FFT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lmap</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">FFT</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># r-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">size</span>

        <span class="c"># r-space spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># r-space samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># r-space lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>

        <span class="c"># k-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span>  <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">))</span>

        <span class="c"># k-space spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># k-space lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span>

        <span class="c"># nyquist</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_u</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_u</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>

        <span class="k">if</span> <span class="n">detrend</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fft</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">lmap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">linear_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="s">&#39;[FFT1D]</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-6s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;shape&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

<span class="k">class</span> <span class="nc">FFT2D</span><span class="p">(</span><span class="n">FFT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lmap</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">FFT</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># r-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">size</span>

        <span class="c"># r-space spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># r-space samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># r-space lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>

        <span class="c"># k-space</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s">&#39;ij&#39;</span><span class="p">)</span>

        <span class="c"># k-space spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># k-space lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dv</span>

        <span class="c"># nyquist</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_u</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_u</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_v</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_v</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">detrend</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fft</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">lmap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">linear_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">win_u</span>  <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">win_v</span>  <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">win_u</span><span class="p">,</span> <span class="n">win_v</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="s">&#39;[FFT2D]</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-6s</span><span class="s"> = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;shape&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

<span class="k">class</span> <span class="nc">FFT3D</span><span class="p">(</span><span class="n">FFT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lmap</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">FFT</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># r-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">size</span>

        <span class="c"># r-space spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># r-space samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c"># r-space lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span>

        <span class="c"># k-space</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="p">))</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s">&#39;ij&#39;</span><span class="p">)</span>

        <span class="c"># k-space samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">du</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># k-space lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dw</span>

        <span class="c"># nyquist</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_u</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_u</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_v</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_v</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_w</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dz</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyquist_w</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">detrend</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_window</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fft</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fftn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">lmap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">linear_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">win_u</span>  <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">win_v</span>  <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">win_w</span>  <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">win_u</span><span class="p">,</span> <span class="n">win_v</span><span class="p">),</span> <span class="n">win_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="s">&#39;[FFT3D]</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;  </span><span class="si">%-6s</span><span class="s"> = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;shape&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Adam Gagorik.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>